(()=>{"use strict";const e=function(e,t,n,o,a,l,c="flex"){const r=document.querySelector(".main"),s=document.createElement("div");s.className="contact",s.style.display=c,r.append(s);const u=document.createElement("div");u.className="userKey",u.style.display="none",u.textContent=l,s.append(u);const i=document.createElement("div");i.className="avatar";const d=document.createElement("img");d.src=a,d.alt="avatar",d.className="avatar-icon",i.append(d);const m=document.createElement("div");m.className="name",m.textContent=e;const f=document.createElement("div");f.className="phone",f.textContent=t;const p=document.createElement("div");p.className="address",p.textContent=n;const y=document.createElement("div");y.className="email",y.textContent=o;const g=document.createElement("div");g.className="edit",g.classList.add("none");const v=document.createElement("button");v.className="btn_edit",v.textContent="Редактировать",g.append(v);const h=document.createElement("button");h.className="btn_remove",h.textContent="Удалить",g.append(h),s.append(i,m,f,p,y,g)},t=function(){let t=document.querySelectorAll(".contact").length;document.querySelector(".main").innerHTML="";let n=[];if(null==localStorage.getItem("phone_book")||null==localStorage.getItem("phone_book"))return;let o=JSON.parse(localStorage.getItem("phone_book"));for(let e in o)o[e].index=e,n.push(o[e]);if(n.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),0===n.length)return;r(n[0]);const a=function(){const e=document.querySelector(".header").clientHeight,t=document.documentElement.clientHeight,n=document.querySelector(".contact").clientHeight;return Math.ceil((t-e+200)/(n+2))}();let l=a;function c(e,t,n,o){for(let a=t;a<n&&a<e.length;a++)r(e[a]),o=a;return o}function r(t){const n=document.getElementById("search");n.value?t.name.includes(n.value)||t.phone.includes(n.value)||t.email.includes(n.value)||t.address.includes(n.value)?e(t.name,t.phone,t.address,t.email,t.avatar,t.index):e(t.name,t.phone,t.address,t.email,t.avatar,t.index,"none"):e(t.name,t.phone,t.address,t.email,t.avatar,t.index)}0===t?(c(n,1,a),l=a-1):1===Math.abs(n.length-t)?c(n,1,n.length):t<a?c(n,1,a):(c(n,1,t),l=t-1),document.querySelector(".main").onscroll=function(e){1!==Math.abs(n.length-t)&&(document.getElementById("search").value||e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight<30&&l+1<n.length&&(l=c(n,l+1,l+1+a,l)))}},n=function(e,t){if(null!==localStorage.getItem("phone_book")&&void 0!==localStorage.getItem("phone_book")){let n=JSON.parse(localStorage.getItem("phone_book"));n[e]=t,localStorage.setItem("phone_book",JSON.stringify(n))}else{let n={};n[e]=t,localStorage.setItem("phone_book",JSON.stringify(n))}};function o(e){document.querySelector(e).style.display="none"}function a(e){document.querySelector(e).style.display="block"}function l(e){e.forEach((function(e){e.value=""}))}function c(e){document.querySelector(e).style.display="block"}const r=function(e,o,a,l,r,s){const u=`\n    <div class="popup-content">\n        <form id="user_change" class="change-user" action="#">\n            <h3>Редактировать пользователя</h3>\n            <div class="user-avatar">\n            <input id="avatar-icon" type="file" name="user_avatar" accept="image/jpeg,image/png" hidden>\n             <label for="avatar-icon">\n             <img src="${r}" alt="avatar" class="user-avatar-icon">\n             </label>\n            </div>\n            <input class="form-input" name="user_name" type="text"  value="${e}" placeholder="Имя" required>\n            <input class="form-input" name="user_phone" type="tel" value="${o}" placeholder="Номер">\n            <input class="form-input" name="user_email" type="email" value="${a}" placeholder="Электронная почта">\n            <input class="form-input" name="user_address" type="text" value="${l}" placeholder="Адрес">\n            <div class="btns">\n                <button class="ok btn">Сохранить</button>\n                <button class="cancel btn">Отмена</button>\n            </div>\n        </form>\n    </div>\n    `,i=document.createElement("div");i.classList.add("popup"),i.classList.add("change"),i.innerHTML=u,document.querySelector("body").append(i);const d=i.querySelector("form"),m=d.querySelector(".cancel");let f=d.user_avatar;const p=d.querySelector("img");let y=r;f.onchange=function(){let e=f.files[0],t=new FileReader;t.readAsDataURL(e),t.onload=function(){p.src=t.result,y=t.result},t.onerror=function(){console.log(t.error)}},d.onsubmit=function(e){e.preventDefault();let o=function(e){if(null!==localStorage.getItem("phone_book")&&void 0!==localStorage.getItem("phone_book"))return JSON.parse(localStorage.getItem("phone_book"))[e]}(s);o.name=d.user_name.value,o.phone=d.user_phone.value,o.email=d.user_email.value,o.address=d.user_address.value,o.avatar=y,n(s,o),t(),c(".menu"),i.remove()},m.onclick=function(e){e.preventDefault(),c(".menu"),i.remove()}},s=function(){document.querySelector(".menu-change").onclick=function(){function e(){a.forEach((e=>{e.removeEventListener("mouseenter",n)}))}function n(n){let o=n.target;o.classList.add("hover"),o.querySelector(".edit").classList.remove("none"),o.querySelector(".btn_edit").onclick=function(){let t=o.querySelector(".name").textContent,n=o.querySelector(".phone").textContent,a=o.querySelector(".email").textContent,l=o.querySelector(".address").textContent,c=o.querySelector("img").src,s=o.querySelector(".userKey").textContent;r(t,n,a,l,c,s),e()},o.querySelector(".btn_remove").onclick=function(){localStorage.getItem("phone_book"),function(e){if(null!==localStorage.getItem("phone_book")&&void 0!==localStorage.getItem("phone_book")){let t=JSON.parse(localStorage.getItem("phone_book"));delete t[e],localStorage.setItem("phone_book",JSON.stringify(t))}}(o.querySelector(".userKey").textContent),t(),e()}}function o(e){let t=e.target;t.classList.remove("hover"),t.querySelector(".edit").classList.add("none")}const a=document.querySelectorAll(".contact");document.querySelector(".menu").style.display="none",a.forEach((e=>{e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",o)}))}};window.addEventListener("load",(()=>{(function(){const e=document.querySelector(".popup-menu"),t=e.querySelectorAll("li");function n(t){switch(t.target.querySelector("svg").style.fill="#fefefe",t.target.style.color="#fefefe",t.target.className){case"menu-add":e.style.setProperty("--color","#263b68 #fefefe #fefefe #fefefe");break;case"menu-export":e.style.setProperty("--color"," #fefefe #263b68 #fefefe #fefefe");break;case"menu-change":e.style.setProperty("--color"," #fefefe #fefefe #263b68 #fefefe");break;case"menu-import":e.style.setProperty("--color"," #fefefe #fefefe #fefefe #263b68")}}document.querySelector(".icon").addEventListener("click",(()=>{document.querySelector(".menu").style.display="block"})),document.querySelector(".menu").addEventListener("click",(e=>{e.target.classList.contains("popup")&&(document.querySelector(".menu").style.display="none")})),t.forEach((t=>{t.addEventListener("mouseenter",n),t.addEventListener("mouseleave",(t=>{t.target.querySelector("svg").style.fill="#263b68",t.target.style.color="#263b68",e.style.setProperty("--color","#fefefe #fefefe #fefefe #fefefe")}))}))})(),t(),function(){const e=document.querySelector(".add");document.querySelector(".menu-add").addEventListener("click",(()=>{a(".add"),o(".menu")}));const c=e.querySelector(".cancel"),r=e.querySelector(".add-user"),s=r.querySelectorAll("input"),u=r.user_avatar,i=r.querySelector("img"),d="./assets/avatar/2550383.png";let m=d;u.oninput=function(){let e=u.files[0],t=new FileReader;t.readAsDataURL(e),t.onload=function(){i.src=t.result,m=t.result},t.onerror=function(){console.log(t.error)}},r.addEventListener("submit",(e=>{e.preventDefault();const c={};s.forEach((e=>{"user_avatar"!==e.name?c[e.name.slice(5)]=e.value:c[e.name.slice(5)]=m}));let r=new Date;n(r.toISOString(),c),t(),l(s),o(".add"),a(".menu"),i.src=d,m=d})),c.addEventListener("click",(e=>{e.preventDefault(),l(s),o(".add"),a(".menu"),i.src=d,m=d}))}(),function(e){const t=document.getElementById(e);t.addEventListener("input",(()=>{let e=document.querySelectorAll(".contact"),n=t.value;e.forEach((e=>{let t=e.querySelector(".name").textContent,o=e.querySelector(".phone").textContent,a=e.querySelector(".email").textContent,l=e.querySelector(".address").textContent;t.includes(n)||o.includes(n)||a.includes(n)||l.includes(n)?e.style.display="flex":e.style.display="none"}))}))}("search"),s(),document.querySelector(".menu-export").onclick=function(){const e={};for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t),o=JSON.parse(localStorage[n]);e["user"+n]=o}const t=JSON.stringify(e,null,"\t"),n=new Blob([t],{type:"json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="exportContacts.json",document.body.appendChild(a),a.click(),document.body.removeChild(a)},document.querySelector(".menu-import").onclick=function(){let e;const o=document.createElement("input");o.type="file",o.accept=".json",document.body.appendChild(o),o.click(),document.body.removeChild(o),o.onchange=function(){let a=o.files[0],l=new FileReader;l.readAsDataURL(a),l.onload=function(){e=l.result,fetch(e).then((e=>e.json())).then((e=>{const o=[];for(let t in e)e[t].avatar||(e[t].avatar="./assets/avatar/2550383.png"),o.push(e[t]);for(let e=0;e<o.length;e++){let t=new Date;n(t.toISOString()+` import ${e}`,o[e])}t()}))},l.onerror=function(){console.log(l.error)}}}}))})();